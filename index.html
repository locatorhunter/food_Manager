<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Security-Policy"
        content="default-src 'self'; script-src 'self' 'unsafe-inline' https://www.gstatic.com https://*.firebaseio.com; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com; connect-src 'self' https://*.googleapis.com https://*.firebaseio.com wss://*.firebaseio.com https://www.gstatic.com https://identitytoolkit.googleapis.com https://firestore.googleapis.com; frame-src https://*.firebaseio.com; img-src 'self' data: https:; font-src 'self' data: https://fonts.gstatic.com;">
    <meta name="description" content="OfzHub - Your office social hub">
    <title>OfzHub - Home</title>
    <link rel="icon" type="image/svg+xml" href="assets/favicon.svg">
    <link rel="alternate icon" type="image/png" href="assets/favicon.png">
    <link rel="stylesheet" href="shared/styles/style.css?v=1.1.0">
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    <script>
        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyCLzX2loYEmPjk0AgH0caHLFBso9yPYTCc",
            authDomain: "foodmanager-19cbb.firebaseapp.com",
            projectId: "foodmanager-19cbb",
            storageBucket: "foodmanager-19cbb.firebasestorage.app",
            messagingSenderId: "853074932493",
            appId: "1:853074932493:web:779a3bd8e5e501cb86f644",
            measurementId: "G-639Z6PMW6R"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();
        const auth = firebase.auth();
        const db = firebase.firestore();

        // Action Code Settings for email verification and password reset
        const currentDomain = window.location.hostname;
        const isLocalhost = currentDomain === 'localhost' || currentDomain === '127.0.0.1';

        window.actionCodeSettings = {
            url: isLocalhost ?
                `http://${currentDomain}/auth/login.html` :
                `https://${currentDomain}/auth/login.html`,
            handleCodeInApp: false
        };

        // Make Firebase available globally
        window.firebaseDB = database;
        window.auth = auth;
        window.db = db;
        window.firebaseRef = (path) => database.ref(path);
        window.firebaseSet = (ref, data) => ref.set(data);
        window.firebaseGet = (ref) => ref.once('value');
        window.firebaseOnValue = (ref, callback) => ref.on('value', callback);
        window.firebasePush = (ref) => ref.push();
        window.firebaseUpdate = (ref, data) => ref.update(data);
        window.firebaseRemove = (ref) => ref.remove();
    </script>
</head>

<body>
    <nav id="navbar"></nav>
    <div id="banner"></div>

    <!-- Hero Section -->
    <section class="hero-section">
        <div class="hero-content">
            <!-- Notice Banner -->
            <div id="noticeBanner" class="notice-banner" style="display: none;">
                <div class="notice-content">
                    <span class="notice-icon">‚ÑπÔ∏è</span>
                    <div class="notice-text">
                        <strong id="noticeTitle">Notice</strong>
                        <span id="noticeMessage">Loading...</span>
                    </div>
                    <button class="notice-close" onclick="hideNotice()" title="Close notice">√ó</button>
                </div>
            </div>

            <h1>Welcome to OfzHub</h1>
            <p class="hero-subtitle">Your office social hub - order food, share moments, and connect with colleagues.
            </p>
            <div class="hero-buttons">
                <a href="menu/menu.html" class="btn btn-secondary btn-large">
                    <span class="btn-icon">üçΩÔ∏è</span>
                    Order Now
                </a>
                <a href="#featured" class="btn btn-secondary btn-large">
                    <span class="btn-icon">üî•</span>
                    Trending
                </a>
                <a href="auragram/auragram.html" class="btn btn-secondary btn-large">
                    <span class="btn-icon">üì∏</span>
                    Auragram
                </a>
            </div>
        </div>
        <!-- Floating Food Cards -->
        <div class="floating-food-container">
            <div class="floating-food food-1">üçï</div>
            <div class="floating-food food-2">üçî</div>
            <div class="floating-food food-3">üåÆ</div>
            <div class="floating-food food-4">üçú</div>
            <div class="floating-food food-5">ü•ó</div>
            <div class="floating-food food-6">üç£</div>
            <div class="floating-food food-7">üçó</div>
            <div class="floating-food food-8">ü•™</div>
            <div class="floating-food food-9">üçù</div>
            <div class="floating-food food-10">ü•ò</div>
            <div class="floating-food food-11">üçõ</div>
            <div class="floating-food food-12">ü•ô</div>
        </div>
    </section>

    <!-- Featured Dishes -->
    <section id="featured" class="featured-section">
        <div class="container">
            <div class="section-header">
                <h2>Trending This Week</h2>
                <p>Discover our most popular and delicious menu items</p>
            </div>
            <div id="popularItems" class="featured-grid"></div>
        </div>
    </section>

    <footer>
        <p>&copy; 2025 OfzHub. All rights reserved. | Developed by Vijay</p>
    </footer>

    <script src="shared/scripts/storage.js?v=1.0.0"></script>
    <script src="shared/scripts/utils.js?v=1.0.0"></script>
    <script src="auth/auth.js?v=1.0.0"></script>
    <script src="shared/scripts/common.js?v=1.0.0"></script>
    <script src="dashboard/dashboard.js"></script>
    <script>
        // Initialize popular items on home page
        document.addEventListener('DOMContentLoaded', function () {
            // Wait for auth service to be ready and check authentication status
            const checkAuth = () => {
                const user = window.authService ? window.authService.getCurrentUser() : null;
                if (!user) {
                    // Redirect to login if not authenticated
                    window.location.href = 'auth/login.html';
                    return;
                }

                displayPopularItems();
                loadAndDisplayNotice();
            };

            // Listen for auth state changes
            const unsubscribe = window.auth && window.auth.onAuthStateChanged((user) => {
                if (user) {
                    // User is signed in, check if we have user data
                    const checkUserData = () => {
                        const currentUser = window.authService ? window.authService.getCurrentUser() : null;
                        if (currentUser) {
                            displayPopularItems();
                            loadAndDisplayNotice();
                        } else {
                            // Wait a bit for user data to be loaded
                            setTimeout(checkUserData, 500);
                        }
                    };
                    checkUserData();
                } else {
                    // User is signed out
                    window.location.href = 'auth/login.html';
                }
                // Unsubscribe after first check
                if (unsubscribe) unsubscribe();
            });

            // Also check immediately in case auth state already loaded
            setTimeout(() => {
                if (window.authService && window.authService.getCurrentUser()) {
                    displayPopularItems();
                    loadAndDisplayNotice();
                }
            }, 100);
        });

        // Notice Banner Functions
        async function loadAndDisplayNotice() {
            try {
                const notice = await StorageManager.getCurrentNotice();
                if (notice && notice.active !== false) {
                    displayNotice(notice);
                } else {
                    hideNotice();
                }
            } catch (error) {
                console.error('Error loading notice:', error);
                hideNotice();
            }
        }

        function displayNotice(notice) {
            const banner = document.getElementById('noticeBanner');
            const titleEl = document.getElementById('noticeTitle');
            const messageEl = document.getElementById('noticeMessage');
            const iconEl = banner.querySelector('.notice-icon');

            if (banner && titleEl && messageEl && iconEl) {
                // Set content
                titleEl.textContent = notice.title || 'Notice';
                messageEl.textContent = notice.message;

                // Set type-specific styling
                const type = notice.type || 'info';
                banner.className = `notice-banner notice-${type}`;

                // Set icon
                switch (type) {
                    case 'success':
                        iconEl.textContent = '‚úÖ';
                        break;
                    case 'warning':
                        iconEl.textContent = '‚ö†Ô∏è';
                        break;
                    case 'error':
                        iconEl.textContent = '‚ùå';
                        break;
                    case 'quote':
                        iconEl.textContent = 'üí≠';
                        break;
                    default:
                        iconEl.textContent = '‚ÑπÔ∏è';
                }

                // Show banner
                banner.style.display = 'block';

                // Add slide-down animation
                banner.style.animation = 'slideDownNotice 0.5s ease-out';
            }
        }

        function hideNotice() {
            const banner = document.getElementById('noticeBanner');
            if (banner) {
                banner.style.display = 'none';
            }
        }
    </script>
</body>

</html>