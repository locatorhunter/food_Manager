<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Lunch Manager - Manage daily employee lunch orders">
    <title>Lunch Manager - Home</title>
    <link rel="stylesheet" href="css/style.css?v=1.1.0">
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    <script>
        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyCLzX2loYEmPjk0AgH0caHLFBso9yPYTCc",
            authDomain: "foodmanager-19cbb.firebaseapp.com",
            projectId: "foodmanager-19cbb",
            storageBucket: "foodmanager-19cbb.firebasestorage.app",
            messagingSenderId: "853074932493",
            appId: "1:853074932493:web:779a3bd8e5e501cb86f644",
            measurementId: "G-639Z6PMW6R"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();
        const auth = firebase.auth();
        const db = firebase.firestore();

        // Action Code Settings for email verification and password reset
        const currentDomain = window.location.hostname;
        const isLocalhost = currentDomain === 'localhost' || currentDomain === '127.0.0.1';
        
        window.actionCodeSettings = {
            url: isLocalhost ? 
                `http://${currentDomain}/login.html` : 
                `https://${currentDomain}/login.html`,
            handleCodeInApp: false
        };

        // Make Firebase available globally
        window.firebaseDB = database;
        window.auth = auth;
        window.db = db;
        window.firebaseRef = (path) => database.ref(path);
        window.firebaseSet = (ref, data) => ref.set(data);
        window.firebaseGet = (ref) => ref.once('value');
        window.firebaseOnValue = (ref, callback) => ref.on('value', callback);
        window.firebasePush = (ref) => ref.push();
        window.firebaseUpdate = (ref, data) => ref.update(data);
        window.firebaseRemove = (ref) => ref.remove();
    </script>
</head>
<body>
    <nav id="navbar"></nav>

    <!-- Hero Section -->
    <section class="hero-section">
        <div class="hero-content">
            <h1>Welcome to Lunch Manager</h1>
            <p class="hero-subtitle">Order your lunch with ease and enjoy great food.</p>
            <div class="hero-buttons">
                <a href="menu.html" class="btn btn-primary btn-large">
                    <span class="btn-icon">ğŸ½ï¸</span>
                    Order Now
                </a>
                <a href="#featured" class="btn btn-secondary btn-large">
                    <span class="btn-icon">ğŸ”¥</span>
                    Trending
                </a>
            </div>
        </div>
        <!-- Floating Food Cards -->
        <div class="floating-food-container">
            <div class="floating-food food-1">ğŸ•</div>
            <div class="floating-food food-2">ğŸ”</div>
            <div class="floating-food food-3">ğŸŒ®</div>
            <div class="floating-food food-4">ğŸœ</div>
            <div class="floating-food food-5">ğŸ¥—</div>
            <div class="floating-food food-6">ğŸ£</div>
            <div class="floating-food food-7">ğŸ—</div>
            <div class="floating-food food-8">ğŸ¥ª</div>
            <div class="floating-food food-9">ğŸ</div>
            <div class="floating-food food-10">ğŸ¥˜</div>
            <div class="floating-food food-11">ğŸ›</div>
            <div class="floating-food food-12">ğŸ¥™</div>
        </div>
    </section>

    <!-- Featured Dishes -->
    <section id="featured" class="featured-section">
        <div class="container">
            <div class="section-header">
                <h2>Trending This Week</h2>
                <p>Discover our most popular and delicious menu items</p>
            </div>
            <div id="popularItems" class="featured-grid"></div>
        </div>
    </section>

    <footer>
        <p>&copy; 2025 Lunch Manager. All rights reserved. | Developed by Vijay</p>
    </footer>
    
    <script src="js/storage.js?v=1.0.0"></script>
    <script src="js/utils.js?v=1.0.0"></script>
    <script src="js/auth.js?v=1.0.0"></script>
    <script src="js/common.js?v=1.0.0"></script>
    <script src="js/dashboard.js"></script>
    <script>
        // Initialize popular items on home page
        document.addEventListener('DOMContentLoaded', function() {
            // Wait for auth service to be ready and check authentication status
            const checkAuth = () => {
                const user = window.authService ? window.authService.getCurrentUser() : null;
                if (!user) {
                    // Redirect to login if not authenticated
                    window.location.href = 'login.html';
                    return;
                }

                displayPopularItems();
            };

            // Listen for auth state changes
            const unsubscribe = window.auth && window.auth.onAuthStateChanged((user) => {
                if (user) {
                    // User is signed in, check if we have user data
                    const checkUserData = () => {
                        const currentUser = window.authService ? window.authService.getCurrentUser() : null;
                        if (currentUser) {
                            displayPopularItems();
                        } else {
                            // Wait a bit for user data to be loaded
                            setTimeout(checkUserData, 500);
                        }
                    };
                    checkUserData();
                } else {
                    // User is signed out
                    window.location.href = 'login.html';
                }
                // Unsubscribe after first check
                if (unsubscribe) unsubscribe();
            });

            // Also check immediately in case auth state already loaded
            setTimeout(() => {
                if (window.authService && window.authService.getCurrentUser()) {
                    displayPopularItems();
                }
            }, 100);
        });
    </script>
</body>
</html>
